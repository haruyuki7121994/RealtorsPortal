@model src.Models.Property
@{
    Layout = "~/Views/Shared/_RealtorsPortalLayout.cshtml";
    ViewData["Title"] = "Profile Page";
}
}
<!-- Start Proerty header  -->
<section id="aa-property-header">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <div class="aa-property-header-inner">
                    <h2>Details Ads</h2>
                    <ol class="breadcrumb">
                        <li><a href="#">HOME</a></li>
                        <li class="active">Customer</li>
                    </ol>
                </div>
            </div>
        </div>
    </div>
</section>
<!-- End Proerty header  -->
<div class="clearfix"></div>
<div style="margin-top: 20px">
    <div class="container">
        <div class="row" style="text-align: center">
            @{
                if (ViewBag.error != null)
                {
                    <div class="error-blog">
                        <h1 style="color: red">@ViewBag.error</h1>
                    </div>
                }
                if (TempData.Peek("Message") != null)
                {
                    <div class="error-blog">
                        <h3 style="color: red">Message: @TempData.Peek("Message")</h3>
                    </div>
                }
            }
        </div>
        <div class="row">
            <div class="col-md-3"></div>
            <div class="col-md-6 wrapper-custom">

                <br />
                <form asp-action="Edit" asp-controller="Customer" enctype="multipart/form-data" method="post">
                    <div asp-validation-summary="ModelOnly" class="text-danger"></div>
                    <input asp-for="Id" name="Id" type="hidden" class="form-control" />
                    <div class="form-group">
                        <label class="control-label">Category</label>
                        <select class="form-control" asp-for="Category_id" asp-items="ViewBag.Categories">
                        </select>
                        <span asp-validation-for="Category_id" class="text-danger"></span>
                    </div>
                    <div class="form-group">
                        <label class="control-label">Type</label>
                        <select class="form-control" asp-for="Method">
                            <option value="sell">Sell</option>
                            <option value="buy">Buy</option>
                            <option value="rent">Rent</option>
                        </select>
                        <span asp-validation-for="Method" class="text-danger"></span>
                    </div>
                    <div class="form-group">
                        <label asp-for="Title" class="control-label">Title</label>
                        <input asp-for="Title" class="form-control" />
                        <span asp-validation-for="Title" class="text-danger"></span>
                    </div>
                    <div class="form-group">
                        <label asp-for="Introduction" class="control-label">Introduction</label>
                        <textarea asp-for="Introduction" class="form-control"></textarea>
                        <span asp-validation-for="Introduction" class="text-danger"></span>
                    </div>
                    <div class="form-group">
                        <label asp-for="Description" class="control-label">Description</label>
                        @Html.TextAreaFor(model => model.Description)
                        <span asp-validation-for="Description" class="text-danger"></span>
                    </div>
                    <div class="form-group">
                        <label asp-for="Price" class="control-label">Price</label>
                        <input asp-for="Price" type="number" class="form-control" />
                        <span asp-validation-for="Price" class="text-danger"></span>
                    </div>
                    <div class="form-group">
                        <label asp-for="Deposit" class="control-label">Deposit</label>
                        <input asp-for="Deposit" type="number" class="form-control" />
                        <span asp-validation-for="Deposit" class="text-danger"></span>
                    </div>
                    <div class="form-group">
                        <img style="width: 100%; object-fit: cover" src="~/@Model.Thumbnail_url" alt="Alternate Text" />
                        <input asp-for="Thumbnail_url" type="hidden" class="form-control" />
                        <br />
                        <label asp-for="Thumbnail_url" class="control-label">New Thumbnail</label>
                        <input name="file" type="file" class="form-control" />
                        <span asp-validation-for="Thumbnail_url" class="text-danger"></span>
                    </div>
                    <div class="form-group">
                        <label class="control-label">Current Location</label>
                        <div style="margin: 10px">
                            <p>Country: @Model.Country.Name</p>
                            <p>Region: @Model.Region.Name</p>
                            <p>City: @Model.City.Name</p>
                            <p>Area: @Model.Area.Name</p>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label">New Location</label>
                    </div>
                    <div class="form-group">
                        <label class="control-label">Country</label>
                        <select class="form-control" id="CountryId" asp-items="ViewBag.Countries">
                            <option value="">Select Countries</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="control-label">Region</label>
                        <select class="form-control" id="RegionId">
                            <option value="">Select Regions</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="control-label">City</label>
                        <select class="form-control" id="CityId">
                            <option value="">Select Cities</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="control-label">Area</label>
                        <input asp-for="Area_id" type="hidden" id="areaHidden" class="form-control" />
                        <select class="form-control" asp-for="Area_id" id="AreaId">
                            <option value="">Select Area</option>
                        </select>
                        <span asp-validation-for="Area_id" class="text-danger"></span>
                    </div>
                    <div class="form-group">
                        <label asp-for="Features" class="control-label">Features</label>
                        <div class="aa-properties-details">
                            <div class="aa-properties-info">
                                <ul id="feature-list">
                                </ul>
                            </div>
                        </div>

                        <div class="input-group">
                            <input class="form-control" id="feature-val" />
                            <span class="input-group-addon" id="btn-add-features" style="cursor: pointer">Add</span>
                        </div>
                        <input asp-for="Features" id="features-in" type="hidden" class="form-control" />
                        <span asp-validation-for="Features" class="text-danger"></span>
                    </div>
                    <div class="form-group">
                        @if (Model.Is_featured)
                        {
                            <label class="control-label">This property is featured</label>
                        }
                        else
                        {
                            <label class="control-label">This property is normal</label>
                        }
                        <input asp-for="Is_featured" name="Is_featured" type="hidden" class="form-control" />
                    </div>
                    <div class="form-group">
                        @Html.ActionLink("Back", "Index", "Customer", null, new { @class = "btn btn-danger" })
                        <input type="submit" value="Edit Ads" class="btn btn-dark" />
                    </div>
                </form>
            </div>
            <div class="col-md-3"></div>
        </div>
    </div>
    <br />
</div>

@section scripts {
    <script>
        $(document).ready(function () {
            let featuresJson = $("#features-in").val();
            let features = [];
            console.log(featuresJson)
            if (featuresJson !== "") {
                features = JSON.parse(featuresJson);
                appendFeatures(features)
            }

            $(document).on('click', "#btn-delete-feature", function () {
                const idx = $(this).data('id')
                if (idx >= 0) {
                    features.splice(idx, 1)
                    appendFeatures(features)
                }
                console.log(features)
            })
            
            $("#btn-add-features").click(function (event) {
                let val = $("#feature-val").val();
                if (val !== "") {
                    features.push(val);
                    $("#feature-val").val("");
                    appendFeatures(features)
                }
                console.log(features)
            })
            CKEDITOR.replace(@Html.IdFor(model => model.Description));
            $("#CountryId").change(function () {
                var countryId = $(this).val();
                $.ajax({
                    type: "POST",
                    url: "/Customer/GetRegions?id=" + countryId,
                    contentType: "html",
                    success: function (res) {
                        $("#RegionId").empty();
                        $("#CityId").empty();
                        $("#AreaId").empty();
                        $("#RegionId").append(res);
                    }
                })
            })

            $("#RegionId").change(function () {
                var regionId = $(this).val();
                $.ajax({
                    type: "POST",
                    url: "/Customer/GetCities?id=" + regionId,
                    contentType: "html",
                    success: function (res) {
                        $("#CityId").empty();
                        $("#AreaId").empty();
                        $("#CityId").append(res);
                    }
                })
            })

            $("#CityId").change(function () {
                var cityId = $(this).val();
                $.ajax({
                    type: "POST",
                    url: "/Customer/GetAreas?id=" + cityId,
                    contentType: "html",
                    success: function (res) {
                        $("#AreaId").empty();
                        $("#AreaId").append(res);
                    }
                })
            })

            $("#AreaId").change(function () {
                $("#areaHidden").remove();
            })

            function appendFeatures(features) {
                let list = '';
                for (var i = 0; i < features.length; i++) {
                    list += "<li>" + features[i] + " <span class='label label-danger' data-id='" + i + "' id='btn-delete-feature' style='cursor: pointer'>x</span></li>"
                }
                $("#feature-list").html(list)
                const featuresJson = JSON.stringify(features);
                $("#features-in").val(featuresJson);
            }
        })
    </script>
}

